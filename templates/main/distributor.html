<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-vWtPOzvV2LtoJMdIo6HfT94oZD8/eeFh0I+1wT6h7ggzmg+7Z0WgVpY+P6r+Qv26" crossorigin="anonymous">
    <title>VROOM - Distributor Profile</title>
  </head>
  <body>
    <div class="container">
      <!-- main button to navigate between car and booking -->
      <div class="sidebar">
        <h1 id="logo">VROOM</h1>
         <ul>
            <li>
                <a id="default-btn" onclick="toggleContent('default')"> 
                    <i class="fas fa-house"></i>
                    <span id="default-topic">Dashboard</span> 
                </a>
            </li>
            <li>
                <a id="car-btn" onclick="toggleContent('car')"> 
                    <i class="fas fa-car"></i>
                    <span id="distributor-topic">Car</span> 
                </a>
            </li>
            <li>
                <a id="booking-btn" onclick="toggleContent('booking')"> 
                    <i class="fas fa-bookmark"></i>
                    <span id="user-topic">Booking</span>
                </a>
            </li>
            
            <li>
                <a href="{% url 'logout' %}" id="logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span id="topic">Log Out</span>
                </a>
            </li>
        </ul>
    </div>

      <!-- initializing count value to 0 for all required details -->
      <script>
        let totalCarCount = 0;
        let totalBookingCount = 0;
        let totalAvailableCarCount = 0;
        let totalBookedCarCount = 0;
        let totalUnlistedCarCount = 0;
        let totalPendingOrderCount = 0;
        let totalApprovedOrderCount = 0;
        let totalPaidOrderCount = 0;
        let totalCompletedOrderCount = 0;
      </script>

      <div class="content">
        <div id="default-content">
          <h1>Welcome Distributor!!</h1>
          <!-- Default dashboard content goes here -->
          <div id="card">
            <div class="card" id="car_card">
              <h3>Car Information</h3>
              <label id="Cars">
                <i class="fas fa-users"></i>
                <span id="TotalCars"></span>
              </label>
              <label id="Types">
                <i class="fas fa-users"></i>
                <span id="car_types"></span>
              </label>
            </div>
            <div class="card" id="book_card">
              <h3>Booking Information</h3>
              <label id="TotalBooking">
                <i class="fa-solid fa-bookmark"></i>
                <span id="booking"></span>
              </label>
              <label id="TotalApproved">
                <i class="fa-solid fa-check"></i>
                <span id="approved"></span>
              </label><br />
              <label id="TotalPending">
                <i class="fa-solid fa-hourglass-half"></i>
                <span id="pending"></span>
              </label>
              <label id="TotalPaid">
                <i class="fa-solid fa-money-check-dollar"></i>
                <span id="paid"></span>
              </label><br />
              <label id="completed"></label><br />
            </div>
          </div>
        </div>
        <div id="car-content">
          <div class="all">
            <!-- filter to navigate different catogeries of cars -->
            <div class="filter">
              <button class="filter-btn" data-category="All">All</button>
              <button class="filter-btn" data-category="SUV">SUV</button>
              <button class="filter-btn" data-category="EV">EV</button>
              <button class="filter-btn" data-category="Truck">Truck</button>
              <button class="filter-btn" data-category="Sedan">Sedan</button>
              <button id="car-add-btn" onclick="openAddCarPopup()">Add</button>
            </div>

            <div class="cards-container">
              <!-- Cards will be dynamically added here -->
              {% for item in items %} 

              <!-- checking car details and updating count -->
              {% if item.availability == "Unlisted" %}
                <script>
                  totalUnlistedCarCount++;
                </script>
              {% elif item.availability == "Available" %}
                <script>
                  totalAvailableCarCount++;
                </script>
              {% elif item.availability == "Booked" %}
                <script>
                  totalBookedCarCount++;
                </script>
              {% endif %}
              <script>
                totalCarCount++;
              </script>

              <div class="card">
                <div class="availability-container  availability-unavailable">
                  <a class="availability">{{ item.availability }}</a>
                </div>
                <img src="{{ item.image.url }}" alt="Car Image" />
                <div class="card-text">
                  <div class="card-details">
                    <h2 class="car-model">{{ item.car_model }}</h2>
                    <h3 class="car-type">{{ item.car_type }}</h3>
                    <h4 class="car-price">Rs {{ item.price }} / day</h4>
                  </div>
                  <div class="buttons">
                      <button id="car-edit-btn" onclick="openEditCarPopup()">Edit</button>
                      <button  id="car-delete-btn" onclick="openDeleteCarPopup()">Delete</button>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>

            <!-- Popup for editing car -->
            <div class="popup" id="editCarPopup">
              <div class="popup-content">
                <span class="close" onclick="closePopup('editCarPopup')">&times;</span>
                <h2>Edit Car</h2>
                <form id="editCarForm">
                  <!-- Add fields for editing car details -->
                  <input type="hidden" id="carId" name="carId" />
                  <label for="editModel">Model:</label><br />
                  <input type="text" id="editModel" name="editModel" /><br />
                  <label for="editPrice">Price:</label><br />
                  <input type="text" id="editPrice" name="editPrice" /><br />
                  <label for="editImage">Car Image:</label><br />
                  <input type="file" id="editImage" name="editImage" /><br /><br />
                  <button type="submit">Save Changes</button>
                </form>
              </div>
            </div>

            <!-- Popup to delete car -->
            <div class="popup" id="deleteCarPopup">
              <div class="popup-content">
                <span class="close" onclick="closePopup('deleteCarPopup')">&times;</span>
                <h2>Delete Car</h2>
                <label for="carIdToDelete">Car ID:</label><br />
                <input type="text" id="carIdToDelete" name="carIdToDelete" /><br />
                <button onclick="deleteCar()">Delete</button>
              </div>
            </div>


            <!-- displaying the total car count in distributor dashboard -->
            <script>
              document.getElementById('TotalCars').innerHTML = 'Total Cars : ' + totalCarCount;
              document.getElementById('Available').innerHTML = 'Available Cars : ' + totalAvailableCarCount;
              document.getElementById('Booked').innerHTML = 'Booked Cars : ' + totalBookedCarCount;
              document.getElementById('Unlisted').innerHTML = 'Unlisted Cars : ' + totalUnlistedCarCount;
             </script>

            <!-- button to navigate different pages of cars -->
            <div class="page-btn">
              <button id="previousPageBtn">Previous Page</button>
              <h2 class="page-number"></h2>
              <button id="nextPageBtn">Next Page</button>
            </div>

            <!-- popup to add car -->
            <div class="popup" id="addCarPopup">
              <div class="popup-content">
                <span class="close" onclick="closePopup('addCarPopup')"
                  >&times;</span
                >
                <h2>Add Car</h2>
                <form id="addCarForm">
                  <label for="renterName">Renter Name:</label><br />
                  <input type="text" id="renterName" name="renterName" /><br />
                  <label for="contactNumber">Contact Number:</label><br />
                  <input
                    type="text"
                    id="contactNumber"
                    name="contactNumber"
                  /><br />
                  <label for="model">Model:</label><br />
                  <input type="text" id="model" name="model" /><br />
                  <label for="price">Price:</label><br />
                  <input type="text" id="price" name="price" /><br />
                  <label for="carImage">Car Image:</label><br />
                  <input
                    type="file"
                    id="carImage"
                    name="carImage"
                  /><br /><br />
                  <button type="submit">Add Car</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div id="booking-content">
          <h2>Booking Information</h2>

          <!-- table to show booking information -->
          <table>
            <thead>
              <tr>
                <th>Product</th>
                <th>Rentee Email</th>
                <th>Booking Start Date</th>
                <th>Booking End Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for order in orders %}
              <!-- Checking order details and updating count -->
              {% if order.status == "Pending" %}
              <script>
                totalPendingOrderCount++;
              </script>
              {% elif order.status == "Approved" %}
              <script>
                totalApprovedOrderCount++;
              </script>
              {% elif order.status == "Paid" %}
              <script>
                totalPaidOrderCount++;
              </script>
              {% endif %}
              <script>
                totalBookingCount++;
              </script>
          
              <tr>
                <td>{{ order.product }}</td>
                <td>{{ order.rentee_email }}</td>
                <td>{{ order.start_date }}</td>
                <td>{{ order.end_date }}</td>
                <td>
                  <!-- Dropdown menu for status -->
                  <select onchange="updateStatus('{{ order.id }}', this.value)">
                    <option value="Pending" {% if order.status == "Pending" %} selected {% endif %}>Pending</option>
                    <option value="Approved" {% if order.status == "Approved" %} selected {% endif %}>Approved</option>
                    <option value="Paid" {% if order.status == "Paid" %} selected {% endif %}>Paid</option>
                  </select>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          

          <!-- displaying the total order count in distributor dashboard -->
          <script>
            document.getElementById('bookings').innerHTML = 'Total Bookings : ' + totalBookingCount;
            document.getElementById('approved').innerHTML = 'Approved Bookings : ' + totalApprovedOrderCount;
            document.getElementById('paid').innerHTML = 'Paid Bookings : ' + totalPaidOrderCount;
            document.getElementById('pending').innerHTML = 'Pending Bookings : ' + totalPendingOrderCount;
            document.getElementById('completed').innerHTML = 'Completed Bookings : ' + totalCompletedOrderCount;
            
           </script>
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  // JavaScript to toggle content based on button clicks

  function toggleContent(topic) {
  document.getElementById("default-content").style.display = topic === 'default' ? "block" : "none";
  document.getElementById("car-content").style.display = topic === 'car' ? "block" : "none";
  document.getElementById("booking-content").style.display = topic === 'booking' ? "block" : "none";
}

  document.addEventListener("DOMContentLoaded", function () {
    var filterButtons = document.querySelectorAll(".filter-btn");
    var cards = document.querySelectorAll(".card");
    var cardsPerPage = 20; // Set the number of cards per page
    var currentPage = 1; // Initialize current page

    // Function to display filtered cards for the current page
    function displayFilteredCards() {
      var filteredCards = document.querySelectorAll(".filtered");
      var startIndex = (currentPage - 1) * cardsPerPage;
      var endIndex = startIndex + cardsPerPage;
      var pagenum = document.querySelector(".page-number");
      pagenum.innerHTML = currentPage;
      filteredCards.forEach(function (card, index) {
        if (index >= startIndex && index < endIndex) {
          card.style.display = "block";
        } else {
          card.style.display = "none";
        }
      });
    }

    //clicking filter buttons
    function clickFilterButton(category) {
      console.log('.filter-btn[data-category="' + category + '"]');
      var button = document.querySelector(
        '.filter-btn[data-category="' + category + '"]'
      );
      if (button) {
        button.click();
        console.log(category + " button clicked");

        // Change the color of the button pressed
        filterButtons.forEach(function (btn) {
          btn.style.backgroundColor = "#2f6690";
        });
        button.style.backgroundColor = "#16425b";

        cards.forEach(function (card) {
          card.classList.remove("filtered");
          console.log(category);
          console.log(card);
          var cardCategory = card.querySelector(".car-type").innerHTML;
          if (category == "All" || category == cardCategory) {
            card.classList.add("filtered");
            card.style.display = "block";
          } else {
            card.style.display = "none";
          }
        });
        displayFilteredCards();
      } else {
        console.error(category + " button not found");
      }
    }

    // Function to get URL parameter by name
    function getUrlParameter(name) {
      name = name.replace(/[[]/, "\\[").replace(/[\]]/, "\\]");
      var regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
      var results = regex.exec(location.search);
      return results === null
        ? ""
        : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    // Get the value from the URL parameter
    var value = getUrlParameter("value");
    console.log(value);
    clickFilterButton(value);

    filterButtons.forEach(function (button) {
      button.addEventListener("click", function () {
        currentPage = 1;
        var category = this.getAttribute("data-category");
        var thisButton = document.querySelector(
          '.filter-btn[data-category="' + category + '"]'
        );
        console.log('.filter-btn[data-category="' + category + '"]');

        // Change the color of the button pressed
        filterButtons.forEach(function (btn) {
          btn.style.backgroundColor = "#2f6690";
        });
        thisButton.style.backgroundColor = "#16425b";

        // Filtering the cards according to the button pressed
        cards.forEach(function (card) {
          card.classList.remove("filtered");
          console.log(category);
          console.log(card);
          var cardCategory = card.querySelector(".car-type").innerHTML; // Assuming category is retrieved from card content
          if (category == "All" || category == cardCategory) {
            card.classList.add("filtered");
            card.style.display = "block";
          } else {
            card.style.display = "none";
          }
        });

        // Display filtered cards on current page
        displayFilteredCards();
      });
    });

    // Add event listener for "Next Page" button
    nextPageBtn.addEventListener("click", function () {
      var totalPages = Math.ceil(
        document.querySelectorAll(".filtered").length / cardsPerPage
      );
      if (currentPage < totalPages) {
        currentPage++;
        displayFilteredCards();
      }
    });

    // Add event listener for "Previous Page" button
    previousPageBtn.addEventListener("click", function () {
      if (currentPage > 1) {
        currentPage--;
        displayFilteredCards();
      }
    });
  });

  function openAddCarPopup() {
    const addCarPopup = document.getElementById("addCarPopup");
    if (addCarPopup) addCarPopup.style.display = "block";
  }

  function openEditCarPopup() {
    const editCarPopup = document.getElementById("editCarPopup");
    if (editCarPopup) editCarPopup.style.display = "block";
  }

  function openDeleteCarPopup() {
    const deleteCarPopup = document.getElementById("deleteCarPopup");
    if (deleteCarPopup) deleteCarPopup.style.display = "block";
  }


  function closePopup(id) {
    document.getElementById(id).style.display = "none";
  }
</script>

<style>
   /* Font Awesome styles */
   @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css');

  /* Set Font Awesome solid icons font family and font weight */
  .fa-solid {
      font-family: 'Font Awesome 6 Solid';
      font-weight: 900;
  }

  :root {
    --indigo: #16425b;
    --lapis: #2f6690;
    --cerulean: #3a7ca5;
    --skyblue: #81c3d7;
    --platinum: #d9dcd6;
    --darkgray: #b4b4b3;
    --red: #f44336;
    --green: #4caf50;
    --darkgreen: darkgreen;
    --crimson: crimson;
    --white: #ffffff;
  }

  body {
    background-color: var(--white);
    margin: 0;
    padding-top: 0;
    overflow-x: hidden;
    font-family: "Montserrat", sans-serif;
  }

  table{
    font-size: 18px;
  }

  table td{
    font-size: 20px;
  }

    /* Logo styles */
    #logo {
    color: var(--platinum);
    margin-top: 30px;
    text-align: center;
    font-size: 3rem;
  }

  /* Sidebar styles */
  .sidebar {
    float: left;
    width: 15vw;
    background-color: var(--indigo);
    height: 100vh;
  }

  .sidebar i{
    color: var(--white);
    margin-left: 50px;
    margin-right: 10px;
  }

  .sidebar ul {
    list-style-type: none;
    padding: 0;
    margin-top: 8vh;
  }

  .sidebar li {
      margin-bottom: 10px;
  }

  .sidebar a {
      font-size: 25px;
      width: 15vw;;
      text-decoration: none;
      color: var(--white);
      display: block;
      margin-top: 50px;
  }

  .sidebar a:hover {
      cursor: pointer;
  }

  /* Log Out button styles */
  #logout {
      position: absolute;
      bottom: 30px;
      left: 20px;
    }

  /* Content styles */
  .content {
    float: left;
    width: 80%;
    padding: 20px 0 0 20px;
    box-sizing: border-box;
  }


  #default-content #card {
    display: flex;
  }

  #car_card,
  #book_card {
    width: 40vw;
    height: 20vh;
  }

  #car_card {
    background-color: var(--skyblue);
  }

  #book_card {
    background-color: var(--platinum);
  }

  #TotalCars,
  #carModels,
  #bookings,
  #pending {
    padding-right: 10vw;
    /* padding-bottom: 5vh; */
  }

  #car-content,
  #booking-content {
    display: none;
    margin-top: 20px;
  }

  #content {
    margin-left: 10vw;
    width: 80vw;
    padding: 20px;
    border: 1px solid var(--platinum);
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  .filter {
    margin: 40px 2%;
    padding-top: 20px;
  }

  .filter-btn {
    padding: 8px 16px;
    border: none;
    background-color: var(--lapis);
    color: var(--platinum);
    cursor: pointer;
    border-radius: 5px;
    margin-right: 10px;
    font-size: medium;
  }

  .filter-btn:hover {
    background-color: var(--indigo);
  }

  .cards-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    padding: 0 20px;
  }

  .card {
    position: relative;
    height: 35vh;
    width: 18vw;
    margin: 2px;
    background-color: var(--platinum);
    border-radius: 15px;
    margin-bottom: 20px;
    box-sizing: border-box;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .card:hover {
    background-color: #b4b4b3;
  }

  .availability-container {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 5px 5px;
    border-radius: 5px;
  }

  .availability-available {
    background-color: var(--green); 
  }

  .availability-unavailable {
    background-color: var(--crimson); 
  }

  .availability {
    color: var(--white); 
    font-weight: normal;
    font-size: 14px;
  }
    
  .card img {
    margin: 0 0;
    border-top-right-radius: 15px;
    border-top-left-radius: 15px;
    width: 100%;
    height: 50%;
  }

  .card-details {
    margin-top: 20px;
    margin-left: 30px;
  }

  .car-price {
    font-size: 1.2rem;
    font-weight: 450;
  }

  .car-model {
    font-size: 1.5rem;
    font-weight: 500;
  }

  .page-btn {
    margin-top: 20px;
    text-align: center;
  }

  .page-btn button {
    padding: 10px 20px;
    background-color: var(--lapis);
    color: var(--platinum);
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-right: 10px;
    margin-bottom: 10px;
  }

  .page-btn button:hover {
    background-color: var(--indigo);
  }

  #car-add-btn {
    background-color: var(--green);
    float: right;
  }

  #car-add-btn:hover {
    background-color: var(--darkgreen);
  }

  /* For User Information Edit */
  table {
    margin-top: 15px;
    border-collapse: collapse;
    width: 78vw;
  }

  th,
  td {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
  }

  th {
    background-color: #f2f2f2;
  }

  tr:nth-child(even) {
    background-color: #f2f2f2;
  }

  #booking-add-btn,
  #booking-delete-btn {
    background-color: var(--green);
    border: none;
    color: white;
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px 10px;
    cursor: pointer;
    border-radius: 4px;
  }

  #booking-add-btn {
    background-color: var(--green);
    margin-right: 40px;
  }

  #booking-add-btn:hover {
    background-color: var(--darkgreen);
  }

  #booking-delete-btn {
    background-color: var(--red);
  }

  #booking-delete-btn:hover {
    background-color: var(--crimson);
  }

  .popup {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
  }

  .popup-content {
    background-color: var(--platinum);
    margin: 20% auto;
    padding: 20px;
    border-radius: 5px;
    width: 60%;
  }

  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }

  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
  }
</style>
