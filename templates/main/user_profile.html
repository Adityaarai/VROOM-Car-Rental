{% extends 'partials/base.html' %} {% load static %} {% block title %} VROOM -
User profile{% endblock %} {% block content %}

<div class="main-container">
  <div class="details">
    <h2>User Profile</h2>
    {% for message in messages %} {% if message.tags == 'error' %}
    <div class="alert alert-danger" role="alert">{{ message }}</div>
    {% elif message.tags == 'success' %}
    <div class="alert alert-success" role="alert">{{ message }}</div>
    {% endif %} {% endfor %}

    <!--buttons in profile page-->
    <button class="button" id="profileBtn">Profile</button>
    <button class="button" id="changePasswordBtn">Change Password</button>
    <button class="button" id="myCarBtn">My Car</button>
    <button class="button" id="myBookingsBtn">My Bookings</button>

    <!-- My Bookings dropdown -->
    <div id="myBookingsDropdown" style="display: none;">
      <button class="dropdown-btn" id="pendingBtn">Pending</button>
      <button class="dropdown-btn" id="approvedBtn">Approved</button>
      <button class="dropdown-btn" id="completedBtn">Completed</button>
    </div>

    <!-- Profile section -->
    <div id="profileSection" class="section">
      <h3>Profile Information</h3>
      <p style="margin-top: 20px; margin-bottom: 10px">
        First Name: <span id="firstName">{{ user.first_name }}</span>
      </p>
      <p style="margin-bottom: 10px">
        Last Name: <span id="lastName">{{ user.last_name }}</span>
      </p>
      <p style="margin-bottom: 10px">
        Username: <span id="username">{{ user.username }}</span>
      </p>
      <p style="margin-bottom: 10px">
        Email: <span id="email">{{ user.email }}</span>
      </p>
      <button class="button" id="editProfileBtn">Edit Profile</button><button id="car-add-btn">Add Car</button>
      <div id="editProfileForm" style="display: none">
        <!-- Edit Profile form -->
        <form
          id="updateProfileForm"
          method="POST"
          action="{% url 'user_profile' %}"
        >
          {% csrf_token %}
          <input type="hidden" name="update_profile" />
          <label for="editFirstName">First Name:</label>
          <input
            type="text"
            id="editFirstName"
            name="first_name"
            value="{{ user.first_name }}"
          /><br />

          <label for="editLastName">Last Name:</label>
          <input
            type="text"
            id="editLastName"
            name="last_name"
            value="{{ user.last_name }}"
          /><br />

          <label for="editUsername">Username:</label>
          <input
            type="text"
            id="editUsername" 
            name="username"
            value="{{ user.username }}"
          /><br />

          <label for="editEmail">Email:</label>
          <input
            type="email"
            id="editEmail"
            name="email"
            value="{{ user.email }}"
          /><br />

          <button class="button" type="submit">Update Profile</button>
        </form>
      </div>
    </div>

    <!-- Change Password section -->
    <div id="changePasswordSection" class="section" style="display: none">
      <h3>Change Password</h3>
      <form
        id="changePasswordForm"
        method="POST"
        action="{% url 'user_profile' %}"
      >
        {% csrf_token %}
        <input type="hidden" name="change_password" />
        <label for="oldPassword">Old Password:</label>
        <input
          type="password"
          id="oldPassword"
          name="old_password"
          required
        /><br />

        <label for="newPassword">New Password:</label>
        <input
          type="password"
          id="newPassword"
          name="new_password1"
          required
        /><br />

        <label for="confirmPassword">Confirm Password:</label>
        <input
          type="password"
          id="confirmPassword"
          name="new_password2"
          required
        /><br />

        <button class="button" type="submit">Update Password</button>
      </form>
    </div>


    
    <!-- popup to add car -->
    <div class="popup" id="addCarPopup">
      <div class="popup-content" >
          <span class="close" id="close" onclick="closePopup('addCarPopup')">&times;</span>
          <h2>Add Car</h2>
          <form id="addCarForm" method="POST" action="{% url 'add_car' %}" enctype="multipart/form-data">
            {% csrf_token %}
              <label for="renterName">Renter Name:</label><br>
              <input type="text" id="renterName" name="renterName"><br>
              <label for="contactNumber">Contact Number:</label><br>
              <input type="text" id="contactNumber" name="contactNumber"><br>
              <label for="car_type">Car Type:</label><br>
              <input type="text" id="car_type" name="car_type"><br>
              <label for="model">Model:</label><br>
              <input type="text" id="model" name="model"><br>
              <label for="price">Price:</label><br>
              <input type="text" id="price" name="price"><br>
              <label for="carImage">Car Image:</label><br>
              <input type="file" id="carImage" name="carImage"><br><br>
              <button type="submit" id="car_done">Add Car</button>
          </form>
          
      </div>
  </div>
    
</div>

<script>


  function closePopup(id) {
      document.getElementById(id).style.display = "none";
    }

  // Adding event listeners for buttons
  document.addEventListener("DOMContentLoaded", function () {
    var editProfileBtn = document.getElementById("editProfileBtn");
    var editProfileForm = document.getElementById("editProfileForm");
    var changePasswordBtn = document.getElementById("changePasswordBtn");
    var changePasswordSection = document.getElementById("changePasswordSection");
    var profileSection = document.getElementById("profileSection");
    var profileBtn = document.getElementById("profileBtn");
    var addCar = document.getElementById("addCarPopup");
    var addBtn = document.getElementById("car-add-btn");
    var myCarBtn = document.getElementById("myCarBtn");
    var myBookingsBtn = document.getElementById("myBookingsBtn");
    var myBookingsDropdown = document.getElementById("myBookingsDropdown");

    profileBtn.addEventListener("click", function () {
      editProfileForm.style.display = "none";
      changePasswordSection.style.display = "none";
      profileSection.style.display = "block";
      addCar.style.display = "none";
    });

    editProfileBtn.addEventListener("click", function () {
      editProfileForm.style.display = "block";
      changePasswordSection.style.display = "none";
      profileSection.style.display = "block";
      addCar.style.display = "none";
    });

    changePasswordBtn.addEventListener("click", function () {
      editProfileForm.style.display = "none";
      changePasswordSection.style.display = "block";
      profileSection.style.display = "none";
      addCar.style.display = "none";
    });

    addBtn.addEventListener("click", function () {
      editProfileForm.style.display = "none";
      changePasswordSection.style.display = "none";
      profileSection.style.display = "block";
      addCar.style.display = "block";
    });

    myCarBtn.addEventListener("click", function () {
      // Handle My Car button click
      editProfileForm.style.display = "none";
      changePasswordSection.style.display = "none";
      profileSection.style.display = "none";
      addCar.style.display = "none";

    });

    myBookingsBtn.addEventListener("click", function () {
      // Handle My Bookings button click to toggle dropdown visibility
      if (myBookingsDropdown.style.display === "none") {
        myBookingsDropdown.style.display = "block";
      } else {
        myBookingsDropdown.style.display = "none";
      }
    });

    // Add event listeners for the dropdown buttons (Pending, Approved, Completed)
    var pendingBtn = document.getElementById("pendingBtn");
    var approvedBtn = document.getElementById("approvedBtn");
    var completedBtn = document.getElementById("completedBtn");

  });
</script>

<style>
  :root {
    --indigo: #16425b;
    --lapis: #2f6690;
    --cerulean: #3a7ca5;
    --skyblue: #81c3d7;
    --platinum: #d9dcd6;
    --darkgray: #b4b4b3;
    --red: #f44336;
    --green: #4CAF50;
    --darkgreen: darkgreen;
    --crimson: crimson;
    --white:#ffffff;
}

  body {
    font-family: "Montserrat", sans-serif;
  }

  .main-container {
    width: 90vw;
    margin: 0 5%;
    margin-top: 9.8vh;
    min-height: 65.6vh;
  }

  .details {
    padding: 40px;
  }

  h2,
  h3 {
    color: var(--indigo);
  }

  .button {
    padding: 8px 16px;
    border: none;
    background-color: var(--lapis);
    color: var(--platinum);
    cursor: pointer;
    border-radius: 5px;
    margin-right: 10px;
    font-size: medium;
    margin-top: 20px;
  }

  .button:hover {
    background-color: var(--indigo);
  }

  .section {
    margin-top: 20px;
  }

  form {
    margin-top: 10px;
  }

  form label {
    display: block;
    margin-bottom: 5px;
  }

  form input {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
  }

  form button {
    padding: 8px 20px;
    background-color: var(--indigo);
    color: var(--white);
    border: none;
    cursor: pointer;
  }

  form button:hover {
    background-color: var(--lapis);
  }

  /* Customizing alert colors */
  .alert-danger {
    color: var(--red);
    font-weight: bold;
  }

  .alert-success {
    color: var(--green);
    font-weight: bold;
  }

  /* Adjusting message display */
  .message {
    margin-top: 20px;
    max-width: 300px;
    word-wrap: break-word; /* Allow long messages to wrap */
  }

  #addCarPopup{
    display: none;
  }

  #close{
    float: right;
    font-size: 30px;
    cursor: pointer;
  }

  #car-add-btn {
    margin-top: 2vh;
    background-color: var(--lapis);
    padding: 8px 27px;
    border: none;
    color: var(--white);
    cursor: pointer;
    border-radius: 5px;
    margin: 10px 0px 10px;
    font-size: medium;
  }

  #car_done{
    margin-top: 2vh;
    background-color: var(--green);
    padding: 8px 27px;
    border: none;
    color: var(--white);
    cursor: pointer;
    border-radius: 5px;
    margin: 10px 0px 10px;
    font-size: medium;
  }

  #car_done:hover {
      background-color: var(--darkgreen);
  }


</style>
{% endblock %}
